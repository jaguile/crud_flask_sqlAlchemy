<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catàleg de llibres de la biblioteca Armand Cardona</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
</head>
<body>
    <nav class="navbar bg-dark navbar-expand-lg" data-bs-theme="dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 fs-1">Biblioteca Armand Cardona</span>
            <div class="collapse navbar-collapse justify-content-center">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a href="#" class="nav-link active">Llibres</a>
                    </li>
                    <li class="nav-item">
                        <a href="{{url_for('main_bp.mostrar_usuaris')}}" class="nav-link">Usuaris</a>
                    </li>
                    <li class="nav-item">
                        <a href="{{url_for('main_bp.mostrar_baixes')}}" class="nav-link">Baixes</a>
                    </li>
                    <li class="nav-item">
                        <a href="{{url_for('main_bp.mostrar_join')}}" class="nav-link">Join</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container mb-4 mt-4">
        {% if not llibres %}
        <h2>Actualment no hi han llibres en el catàleg</h2>
        {% else %}
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Autor</th>
                    <th scope="col">titol</th>
                    <th scope="col">Prestat</th>
                    <th scope="col"><input type="checkbox" id="global_esborrar"></th>
                </tr>
            </thead>
            <tbody>
                <form method="POST" id="form_llibres">
            {% for llibre in llibres %}
                <tr>
                    <th scope="row">{{llibre.id}}</th>
                    <td>{{llibre.autor}}</td>
                    <td>{{llibre.titol}}</td>
                    <td>
                    {% if llibre.prestat == 0 %}
                    <button type="button" class="btn btn-primary btn-prestec"  
                            data-bs-target="#usuarisPrestec" 
                            data-titol="{{llibre.titol}}" data-llibre="{{llibre.id}}">
                        PRESTAR
                    </button>
                    {% else %}
                    <a href="{{url_for('main_bp.prestar_llibre', idLlibre = llibre.id, idUsuari = 0)}}" >
                        USUARI: {{llibre.prestat}}
                    </a>
                    {% endif %}
                    </td>
                    <td><input type="checkbox" name="llibre" value="{{llibre.id}}" class="esborra_llibre"></td>
                </tr>
            {% endfor %}
                <tr>
                    <th scope="row" colspan="4"></th>
                    <td><span>
                        <a href="#" data-action="{{url_for('main_bp.esborrar_llibres')}}" id="global_esborrar_action">
                            <img src="static/img/delete.png" style="width: 15px;"/>
                        </a>
                    </span></td>
                </tr>
                </form>
            </tbody>
        </table>
        {%endif%}
    </div>
    <div class="container">
        <form action="{{url_for('main_bp.afegir_llibre')}}" method="GET" id="afegir_llibre">
            <div class="mb-3">
                <label for="titol" class="form-label">Títol</label>
                <input type="text" class="form-control" id="titol" name="titol" aria-describedby="titolHelp">
                <div id="titolHelp" class="form-text">Títol del llibre a afegir al catàleg</div>
            </div>
            <div class="mb-3">
                <label for="autor" class="form-label">Autor</label>
                <input type="text" class="form-control" id="autor" name="autor">
            </div>
            <button type="submit" class="btn btn-primary">Afegir llibre</button>
        </form>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="usuarisPrestec" data-llibre=""
        tabindex="-1" aria-labelledby="llibrePrestat" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="llibrePrestat">Prestar llibre - llistat usuaris</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                </button>
            </div>
            {% if usuaris %}
            <form action="{{url_for('main_bp.prestar_llibre')}}" id="form_prestec" method="GET">
            <div class="modal-body container">
                <div class="row">
                    <div class="col">
                        <label for="idLlibre" class="form-label">Id del llibre: </label>
                    </div>
                    <div class="col-2">
                        <input type="text" name="idLlibre" id="idLlibre" class="form-control" readonly/>
                    </div>
                </div>
                {% for usuari in usuaris %}
                <div class="row">
                    <div class="col">
                        {{usuari.id}} - {{usuari.nom}} - {{usuari.dni}}
                    </div>
                    <div class="col-1">
                        <input type="radio" name="idUsuari" id="idUsuari" value="{{usuari.id}}">
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="prestar-llibre">Prestar</button>
            </div>
            </form>
            {% else %}
            <div class="modal-body">
                Actualment no hi han usuaris 
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
            {% endif %}
            </div>
        </div>
    </div>
    <script src="static/js/cataleg.js"></script>
</body>
</html>